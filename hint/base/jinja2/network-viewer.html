{% extends 'base.html' %}

{% block head %}
    <script defer src="{{ static('js/cytoscape.min.js') }}"></script>
    <script defer src="{{ static('js/alpine.min.js') }}"></script>
    <script src="{{ static('js/net-viewer.js') }}"></script>
{% endblock %}

{% macro interaction_table(interactions, name, load_more) %}
<table class="min-w-full divide-y divide-gray-300">
    <thead class="bg-gray-50">
        <tr>
            <th scope="col"
                class="py-3.5
                       pl-4
                       pr-3
                       text-left
                       text-sm
                       font-semibold
                       text-gray-900
                       sm:pl-6">
                Protein 1</th>
            <th scope="col"
                class="px-3
                       py-3.5
                       text-left
                       text-sm
                       font-semibold
                       text-gray-900">
                Protein 2</th>
            <th scope="col"
                class="px-3
                       py-3.5
                       text-left
                       text-sm
                       font-semibold
                       text-gray-900">
                Evidence</th>
        </tr>
    </thead>
    <tbody class="divide-y divide-gray-200 bg-white">
        {% for it in interactions %}
        <tr>
            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                {% if it["p1__gene_accession"] %}
                    <a href="https://www.genecards.org/cgi-bin/carddisp.pl?gene={{ it["p1__gene_accession"] }}"
                       class="text-sm font-semibold leading-6 text-indigo-600 hover:text-indigo-400"
                       target="_blank">
                        {{ it["p1__gene_accession"] }}
                    <svg class="pointer-events-none relative bottom-0.5 inline h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                    </svg>
                    </a>
                    <br>
                {% endif %}
                <a href='https://www.uniprot.org/uniprotkb/{{ it["p1__uniprot_accession"] }}/entry'
                   class="text-sm font-semibold leading-6 text-indigo-600 hover:text-indigo-400"
                   target="_blank">
                    {{ it["p1__uniprot_accession"] }}
                    <svg class="pointer-events-none relative bottom-0.5 inline h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                    </svg>
                </a>
            </td>
            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                {% if it["p2__gene_accession"] %}
                    <a href="https://www.genecards.org/cgi-bin/carddisp.pl?gene={{ it["p2__gene_accession"] }}"
                       class="text-sm font-semibold leading-6 text-indigo-600 hover:text-indigo-400"
                       target="_blank">
                        {{ it["p2__gene_accession"] }}
                    <svg class="pointer-events-none relative bottom-0.5 inline h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                    </svg>
                    </a>
                    <br>
                {% endif %}
                <a href="https://www.uniprot.org/uniprotkb/{{ it["p2__uniprot_accession"] }}/entry"
                   class="text-sm font-semibold leading-6 text-indigo-600 hover:text-indigo-400"
                   target="_blank">
                    {{ it["p2__uniprot_accession"] }}
                    <svg class="pointer-events-none relative bottom-0.5 inline h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                    </svg>
                </a>
            </td>
            <td id='evidence-{{ it["id"] }}'
                class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                <button type="button"
                        class="rounded-md
                            bg-indigo-600
                            px-3 py-2
                            text-sm font-semibold
                            text-white shadow-sm
                            hover:bg-indigo-500
                            focus-visible:outline
                            focus-visible:outline-2
                            focus-visible:outline-offset-2
                            focus-visible:outline-indigo-600"
                            hx-get='{{ url("interaction-evidence", kwargs={"interaction_id": it["id"], "ev_type": evidence_type, "ev_quality": quality}) }}'
                            hx-target='#evidence-{{ it["id"] }}'
                            >
                            Load evidence {{ it["num_evidence"] }}
                </button>
            </td>
        </tr>
        {% endfor %}
        {% if load_more %}
        <tr id="load-more-{{ name }}">
            <td colspan="3" scope="colgroup">
                <button
                    id="load-more-{{ accordion_index }}"
                    type="button"
                    class="rounded-md
                        bg-indigo-600
                        px-3 py-2
                        w-full
                        text-sm font-semibold
                        text-white shadow-sm
                        hover:bg-indigo-500
                        focus-visible:outline
                        focus-visible:outline-2
                        focus-visible:outline-offset-2
                        focus-visible:outline-indigo-600">
                    <span>Load more interactions</span>
                </button>
            </td>
        </tr>
        {% endif %}
    </tbody>
</table>
{% endmacro %}

{% block content %}
<div class="bg-white px-6 py-12 lg:px-8">
{% if main_interactions is defined %}
    {% if "message" in network_data %}
    {% else %}
        <div id="cy"
             class="w-1/2
                    aspect-square
                    block
                    mx-auto
                    bg-gray-50
                    ">
        </div>
        <script>
            document.addEventListener('alpine:init', () => {
                var network_data = {{ network_data | tojson }};
                plot_network(network_data);
            });
        </script>
    {% endif %}
    <div class="mx-auto max-w-5xl text-base leading-7 text-gray-700">
        <h1 class="mt-2 text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl pt-12 pb-10">
            Interactome explorer
        </h1>
        <h2 class="mt-4 text-2xl font-bold tracking-tight text-gray-900 sm:text-3xl pb-4" >
            {{ main_interactions_count }} Interactions involving selected proteins
        </h2>
        {{ interaction_table(main_interactions, "main", main_load) }}
        {% if neighbors_interactions is defined %}
            <h2 class="mt-4 text-2xl font-bold tracking-tight text-gray-900 sm:text-3xl pb-4" >
                {{ neighbors_interactions_count }} Interactions involving neighbors
            </h2>
            {{ interaction_table(neighbors_interactions, "neighbors", neigh_load) }}
        {% endif %}
    </div>
{% else %}
    <h2>No results were found.</h2>
{% endif %}
</div>
{% endblock %}

